<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Rengoku</title>

		<link rel="stylesheet" href="css/water.min.css" />
		<link rel="stylesheet" href="css/styles.css" />
		<link rel="shortcut icon" href="assets/icons/folder.svg" type="image/x-icon" />

		<script src="js/script.js"></script>
		<script src="js/tree.js"></script>
		<script src="js/alpine.min.js" defer></script>
	</head>

	<body>
		<nav>
			<div class="row">
				<h1>Rengoku</h1>
				<button class="m-l-auto" @click="document.getElementById('addBookmark').showModal()">
					+ Add Bookmark
				</button>
			</div>
			<hr />
		</nav>
		<aside
			id="folders"
			x-data="{...fileTree(), tree: []}"
			x-effect="async () => { 
				tree = await api('/folders/tree')
			}"
		>
			<h2>Folders</h2>
			<ul>
				<template x-for="(level,i) in tree">
					<li x-html="renderLevel(level,i)"></li>
				</template>
			</ul>
		</aside>
		<main x-data="{ bookmarks: [], more: true }">
			<div
				class="bookmark-list"
				x-effect="async () => { 
					const res = await api('/bookmarks' + $store.queryParams.get()) 
					bookmarks = [...bookmarks, ...res.data]
					more = res.data.length > 0 // TODO: Fix off-by-one error
				}"
				@update.window="() => {
					switch ($event.detail.type) {
						case 'add':
							bookmarks.push($event.detail.data)
							break;
														
						case 'delete':
							const i = bookmarks.findIndex((bm) => bm.id === $event.detail.data)
							bookmarks.splice(i, 1)
							break;
					}
				}"
			>
				{{block "bookmark" .}} {{end}}
			</div>
			<div style="text-align: center" x-show="more">
				<button @click="$store.queryParams.page++">Load more</button>
			</div>
		</main>
		<aside id="filters">{{block "filter-sidebar" .}} {{end}}</aside>
		{{block "settings-dialog" .}} {{end}} {{block "add-bookmark-dialog" .}} {{end}}
	</body>
</html>
